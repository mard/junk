# Local development

Based upon [these](https://github.com/microsoft/azure-devops-extension-hot-reload-and-debug) instructions.

* [Visual Studio Code](https://code.visualstudio.com/)
* [Mozilla Firefox](https://www.mozilla.org/pl/firefox/) (because Visual Studio Code Debugger for Chrome extension [doesn't support IFrames](https://github.com/microsoft/vscode-chrome-debug/issues/786))
* [Debugger for Firefox Visual Studio Code extension](https://marketplace.visualstudio.com/items?itemName=firefox-devtools.vscode-firefox-debug)
* The [tfx-cli](https://www.npmjs.com/package/tfx-cli) npm package `npm install -g tfx-cli`
* The [webpack](https://www.npmjs.com/package/webpack) npm package `npm install -g webpack`
* The [webpack-dev-server](https://www.npmjs.com/package/webpack-dev-server) npm package `npm install -g webpack-dev-server`

# First time setup

If you haven't already, access your [Azure DevOps](https://dev.azure.com/) organization, then generate a new [Azure DevOps Personal Access Token](https://dev.azure.com/mardz/_usersSettings/tokens). Make sure that your token has its access set to **All accessible organizations** and is within **Marketplace (Publish)** scope as well.

More information on Personal Access Tokens is available [here](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops).

Now you're ready to publish your development extension. Log in into your Azure DevOps organization using `tfx login` command where you will be asked to authenticate in keyboard-interactive mode.

```text
PS> tfx login

TFS Cross Platform Command Line Interface v0.7.9
Copyright Microsoft Corporation
> Service URL: https://dev.azure.com/mardz
> Personal access token: [token]
Logged in successfully
```

Now you're able to deploy your extension.

```text
PS> tfx extension publish --manifest-globs vss-extension.json --overrides-file configs/dev.json --token [token]

TFS Cross Platform Command Line Interface v0.7.9
Copyright Microsoft Corporation
Checking if this extension is already published
It isn't, create a new extension.

== Extension Validation In Progress ==
This should take only a few seconds, but in some cases may take a bit longer. You can choose to exit (Ctrl-C) if you don't want to wait. To get the validation status, you may run the command below. If you don't want TFX to wait for validation, use the --no-wait-validation parameter. This extension will be available after validation is successful.

tfx extension isvalid --publisher mard --extension-id codenames-dev --version 0.0.12 --service-url https://marketplace.visualstudio.com/ --token <your PAT>

=== Completed operation: publish extension ===
 - Packaging: C:\Users\dziemianowiczm\repos\junk\codenames\mard.codenames-dev-0.0.12.vsix
 - Publishing: success
 - Sharing: not shared (use --share-with to share)
```

Navigate to your [Marketplace publishing management page](https://marketplace.visualstudio.com/manage/publishers).

Right click on your development extension and share it within your organization (alternatively, you can publish your extension with --share-with parameter as indicated above).

Right click on your development extension and click *View Extension*, click *Get it free* button and proceed with the instructions to install it within your organization.

In [your Azure DevOps organization](https://dev.azure.com), click *Organization settings* on bottom left of your screen. Go to *Process*, and add the control to the desired work item types.

## Launch your dev server

After you `npm run compile`'d your project, you can run the local development web server with your compiled extension.

```
PS> webpack-dev-server --mode development
i ｢wds｣: Generating SSL Certificate
i ｢wds｣: Project is running at https://localhost:3000/
i ｢wds｣: webpack output is served from /dist/
i ｢wds｣: Content not from webpack is served from C:\Users\dziemianowiczm\repos\junk\codenames
i ｢wdm｣: Hash: ebe35c08fb782c290431
Version: webpack 4.41.0
Time: 3653ms
Built at: 2019-10-07 5:34:58 PM
         Asset       Size     Chunks             Chunk Names
Codenames.html  204 bytes             [emitted]
  codenames.js   5.14 MiB  codenames  [emitted]  codenames
...
```

You can also run `npm run start:dev` to do the same.

In Firefox, navigate to https://localhost:3000/ and accept the security exception for the certificate generated by the local server.

You're all set. Go to your Work item and see the magic happen from within your server.
